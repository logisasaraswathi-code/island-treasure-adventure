<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Treasure Map Quest</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
<style>
  body { margin:0; padding:0; overflow:hidden; }
  #ui { position:absolute; bottom:10px; width:100%; display:flex; justify-content:center; gap:10px; }
  .btn { background: rgba(0,0,0,0.5); color:white; font-size:20px; padding:15px; border-radius:10px; user-select:none; }
  #feedback { position:absolute; top:20px; width:100%; text-align:center; font-size:24px; font-weight:bold; color:white; text-shadow:2px 2px black; }
</style>
</head>
<body>
<div id="feedback"></div>
<div id="ui">
  <div class="btn" id="up">‚Üë</div>
  <div class="btn" id="left">‚Üê</div>
  <div class="btn" id="down">‚Üì</div>
  <div class="btn" id="right">‚Üí</div>
  <div class="btn" id="jump">‚§¥</div>
</div>
<script>
let config = {
  type: Phaser.AUTO,
  width: window.innerWidth,
  height: window.innerHeight,
  parent: document.body,
  physics: { default: 'arcade', arcade: { gravity: {y:0}, debug:false } },
  scene: { preload: preload, create: create, update: update }
};

let game = new Phaser.Game(config);
let player, cursors, treasures, feedbackText, aiExplorers=[];
let coins = 0;

function preload() {
  // Map background placeholder
  this.load.image('island', 'https://i.imgur.com/4AiXzf8.jpg'); // Use realistic island image
  // Explorer sprites (placeholder)
  this.load.spritesheet('player', 'https://i.imgur.com/HRQ1vRv.png', { frameWidth: 32, frameHeight: 48 });
  this.load.spritesheet('ai', 'https://i.imgur.com/HRQ1vRv.png', { frameWidth: 32, frameHeight: 48 });
  // Treasure image
  this.load.image('treasure', 'https://i.imgur.com/OdL0XPt.png');
}

function create() {
  // Background
  this.add.image(config.width/2, config.height/2, 'island').setDisplaySize(config.width, config.height);
  
  // Feedback text
  feedbackText = document.getElementById('feedback');
  
  // Player
  player = this.physics.add.sprite(100, 100, 'player', 0);
  player.setCollideWorldBounds(true);
  
  // Player animations
  this.anims.create({ key:'walk', frames:this.anims.generateFrameNumbers('player', {start:0,end:3}), frameRate:8, repeat:-1 });
  
  // AI Explorers
  for(let i=0;i<2;i++){
    let ai = this.physics.add.sprite(200+200*i, 200, 'ai',0);
    aiExplorers.push(ai);
    this.physics.add.overlap(ai, treasures, (ai,t)=>collectTreasure(ai,t,false));
  }
  
  // Treasures
  treasures = this.physics.add.group();
  spawnTreasure(this);
  
  // Collision detection
  this.physics.add.overlap(player, treasures, (player,t)=>collectTreasure(player,t,true));
  
  // Controls
  cursors = {up:false, down:false, left:false, right:false, jump:false};
  
  // Button events
  document.getElementById('up').addEventListener('pointerdown',()=>cursors.up=true);
  document.getElementById('up').addEventListener('pointerup',()=>cursors.up=false);
  document.getElementById('down').addEventListener('pointerdown',()=>cursors.down=true);
  document.getElementById('down').addEventListener('pointerup',()=>cursors.down=false);
  document.getElementById('left').addEventListener('pointerdown',()=>cursors.left=true);
  document.getElementById('left').addEventListener('pointerup',()=>cursors.left=false);
  document.getElementById('right').addEventListener('pointerdown',()=>cursors.right=true);
  document.getElementById('right').addEventListener('pointerup',()=>cursors.right=false);
  document.getElementById('jump').addEventListener('pointerdown',()=>cursors.jump=true);
  document.getElementById('jump').addEventListener('pointerup',()=>cursors.jump=false);
  
  // Camera
  this.cameras.main.startFollow(player);
}

function update() {
  let speed = 150;
  if(cursors.left) player.setVelocityX(-speed);
  else if(cursors.right) player.setVelocityX(speed);
  else player.setVelocityX(0);
  
  if(cursors.up) player.setVelocityY(-speed);
  else if(cursors.down) player.setVelocityY(speed);
  else player.setVelocityY(0);
  
  if(player.body.velocity.x!==0 || player.body.velocity.y!==0) player.anims.play('walk',true);
  else player.anims.stop();
  
  // AI movement towards random treasure
  aiExplorers.forEach(ai=>{
    if(treasures.getChildren().length>0){
      let t = Phaser.Utils.Array.GetRandom(treasures.getChildren());
      this.physics.moveToObject(ai, t, 100);
    } else ai.setVelocity(0);
  });
}

// Spawn treasures randomly
function spawnTreasure(scene){
  for(let i=0;i<5;i++){
    let x = Phaser.Math.Between(100, config.width-100);
    let y = Phaser.Math.Between(100, config.height-100);
    let t = treasures.create(x,y,'treasure');
    t.setScale(0.5);
    t.setInteractive();
    t.collected=false;
  }
}

// Collect treasure
function collectTreasure(character, treasure, isPlayer){
  if(treasure.collected) return;
  treasure.collected = true;
  treasure.disableBody(true,true);
  
  let isRare = Math.random()<0.1;
  let earned = isRare?Phaser.Math.Between(8000,10000):4000;
  
  if(isPlayer){
    coins += earned;
    feedbackText.innerHTML = isRare? "üåü Rare treasure collected! +"+earned:"üéâ You found a treasure! +"+earned;
    feedbackText.style.color = isRare?'gold':'lime';
  } else {
    feedbackText.innerHTML = "‚ùå Oops! AI found the treasure first.";
    feedbackText.style.color = 'red';
  }
  
  // Fade out feedback
  setTimeout(()=>{feedbackText.innerHTML='';},2000);
}
</script>
</body>
</html>
