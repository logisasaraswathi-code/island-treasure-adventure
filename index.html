<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Treasure Map Cinematic Game</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
<style>
  body { margin:0; padding:0; overflow:hidden; background:black; }
  #feedback { position:absolute; top:10px; width:100%; text-align:center; font-size:24px; font-weight:bold; color:white; text-shadow:2px 2px black; z-index:10; }
  #score { position:absolute; top:50px; left:20px; font-size:20px; color:gold; font-weight:bold; text-shadow:2px 2px black; z-index:10; }
  #ui { position:absolute; bottom:15px; width:100%; display:flex; justify-content:center; gap:10px; z-index:10; }
  .btn { background:rgba(0,0,0,0.5); color:white; font-size:20px; padding:12px; border-radius:8px; user-select:none; }
</style>
</head>
<body>

<div id="feedback"></div>
<div id="score">Coins: 0</div>
<div id="ui">
  <div class="btn" id="left">⬅</div>
  <div class="btn" id="right">➡</div>
  <div class="btn" id="up">⬆</div>
  <div class="btn" id="down">⬇</div>
  <div class="btn" id="jump">⤴</div>
</div>

<script>
let config = {
  type: Phaser.AUTO,
  width: window.innerWidth,
  height: window.innerHeight,
  physics: { default:'arcade', arcade:{ gravity:{y:0}, debug:false } },
  scene: { preload, create, update }
};

let game = new Phaser.Game(config);

let player, aiGroup, treasures, cursors={}, particles;
let feedbackEl, scoreEl;
let coins=0;

function preload() {
  // Real CDN assets (these should load)
  this.load.image('bg','https://images.pexels.com/photos/355747/pexels-photo-355747.jpeg'); // jungle background
  this.load.spritesheet('player','https://labs.phaser.io/assets/sprites/dude.png',{ frameWidth:32, frameHeight:48 });
  this.load.spritesheet('ai','https://labs.phaser.io/assets/sprites/dude.png',{ frameWidth:32, frameHeight:48 });
  this.load.image('treasure','https://labs.phaser.io/assets/sprites/chest.png');
  this.load.image('spark','https://labs.phaser.io/assets/particles/yellow.png');
  this.load.audio('bgm','https://actions.google.com/sounds/v1/ambiences/jungle.ogg');
}

function create() {
  feedbackEl = document.getElementById("feedback");
  scoreEl = document.getElementById("score");

  let music = this.sound.add('bgm',{loop:true,volume:0.5});
  music.play();

  // background
  this.add.image(config.width/2,config.height/2,'bg').setDisplaySize(config.width,config.height);

  // player
  player = this.physics.add.sprite(100,config.height-120,'player').setScale(2);
  this.anims.create({key:'walk',frames:this.anims.generateFrameNumbers('player',{start:0,end:3}),frameRate:8,repeat:-1});
  player.setCollideWorldBounds(true);

  // AI explorers
  aiGroup = this.physics.add.group();
  for(let i=0;i<2;i++){
    let ai = this.physics.add.sprite(Phaser.Math.Between(300,config.width-100),Phaser.Math.Between(150,config.height-200),'ai').setScale(2).setTint(0xff4444);
    this.anims.create({key:'aiWalk'+i,frames:this.anims.generateFrameNumbers('ai',{start:0,end:3}),frameRate:6,repeat:-1});
    ai.anims.play('aiWalk'+i,true);
    aiGroup.add(ai);
  }

  // treasures
  treasures = this.physics.add.group();
  for(let i=0;i<6;i++){
    let t = treasures.create(Phaser.Math.Between(100,config.width-100),Phaser.Math.Between(100,config.height-200),'treasure').setScale(0.7);
  }

  particles = this.add.particles('spark');

  this.physics.add.overlap(player,treasures,collectTreasure,null,this);

  ['left','right','up','down','jump'].forEach(key=>{
    cursors[key]=false;
    document.getElementById(key).addEventListener('pointerdown',()=>cursors[key]=true);
    document.getElementById(key).addEventListener('pointerup',()=>cursors[key]=false);
  });
}

function update() {
  let speed = 200;
  player.setVelocity(0);

  if(cursors.left) player.setVelocityX(-speed);
  if(cursors.right) player.setVelocityX(speed);
  if(cursors.up) player.setVelocityY(-speed);
  if(cursors.down) player.setVelocityY(speed);
  if(player.body.velocity.x||player.body.velocity.y) player.anims.play('walk',true);
  else player.anims.stop();

  aiGroup.getChildren().forEach(ai=>{
    ai.setVelocity(Phaser.Math.Between(-100,100),Phaser.Math.Between(-100,100));
  });
}

function collectTreasure(player, treasure) {
  treasure.disableBody(true,true);
  let earned = Phaser.Math.Between(2000,8000);
  coins += earned;
  scoreEl.textContent = "Coins: "+coins;

  feedbackEl.textContent = "✨ +"+earned+"!";
  feedbackEl.style.color='gold';

  let emitter = particles.createEmitter({
    x: treasure.x,
    y: treasure.y,
    speed:{min:-200,max:200},
    lifespan:700,
    quantity:25,
    scale:{start:0.6,end:0}
  });

  setTimeout(()=>{emitter.stop();feedbackEl.textContent='';},900);
}
</script>

</body>
</html>
